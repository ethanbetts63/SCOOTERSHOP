{% extends "dashboard/admin_layout.html" %}
{% load static %}

{% block extra_css %}
<style>
    .form-check input {
        border: 1px solid #ccc;
        color: #000;
    }
    .form-check-label {
        color: #000;
    }
</style>
{% endblock %}

{% block admin_main_content %}
<div class="container mx-auto px-4 py-8">
    <div class="bg-white shadow-lg rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
            Visibility Settings
        </h1>

        <p class="text-gray-600 mb-6">Control which features are visible and enabled on your website. Disabled pages will appear blue in the navigation bar from the perspective of an admin account and will not appear at all from the perspective of a user account.</p>

        <form method="post" class="space-y-6">
            {% csrf_token %}

            <div class="flex justify-end mb-4">
                <button type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l" id="editButton">Edit</button>
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4" id="saveButton">Save Changes</button>
                <button type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r" id="resetButton">Reset</button>
            </div>

            <div class="space-y-4">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Feature Visibility</h3>

                <div class="form-check">
                    {{ form.enable_service_booking }}
                    <label class="form-check-label" for="{{ form.enable_service_booking.id_for_label }}">
                        Enable Service Booking
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to book motorcycle services online
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_user_accounts }}
                    <label class="form-check-label" for="{{ form.enable_user_accounts.id_for_label }}">
                        Enable User Accounts
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to register and maintain accounts
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_contact_page }}
                    <label class="form-check-label" for="{{ form.enable_contact_page.id_for_label }}">
                        Enable Contact Page
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to access the contact us page
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_map_display }}
                    <label class="form-check-label" for="{{ form.enable_map_display.id_for_label }}">
                        Enable Map Display
                    </label>
                    <small class="form-text text-gray-500">
                        Show location map on relevant pages
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_featured_section }}
                    <label class="form-check-label" for="{{ form.enable_featured_section.id_for_label }}">
                        Enable Featured Section
                    </label>
                    <small class="form-text text-gray-500">
                        Display featured motorcycles or content on the homepage
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_privacy_policy_page }}
                    <label class="form-check-label" for="{{ form.enable_privacy_policy_page.id_for_label }}">
                        Enable Privacy Policy Page
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to access the privacy policy page
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_returns_page }}
                    <label class="form-check-label" for="{{ form.enable_returns_page.id_for_label }}">
                        Enable Returns Page
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to access the returns page
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_security_page }}
                    <label class="form-check-label" for="{{ form.enable_security_page.id_for_label }}">
                        Enable Security Page
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to access the security page
                    </small>
                </div>

                <div class="form-check">
                    {{ form.enable_terms_page }}
                    <label class="form-check-label" for="{{ form.enable_terms_page.id_for_label }}">
                        Enable Terms and Conditions Page
                    </label>
                    <small class="form-text text-gray-500">
                        Allow users to access the terms and conditions page
                    </small>
                </div>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editButton = document.getElementById('editButton');
        const saveButton = document.getElementById('saveButton');
        const resetButton = document.getElementById('resetButton');
        // Select form fields within this specific form
        const mainForm = document.querySelector('form[method="post"]');
        const formFields = mainForm.querySelectorAll('input, select, textarea');

        // Function to set form fields read-only or enabled
        function setFormReadonly(readonly) {
            formFields.forEach(field => {
                if (readonly) {
                    field.setAttribute('readonly', true);
                    // Prevent checkbox interaction when read-only
                    if (field.type === 'checkbox' || field.tagName === 'SELECT') {
                         field.setAttribute('disabled', true);
                    }
                } else {
                    field.removeAttribute('readonly');
                     if (field.type === 'checkbox' || field.tagName === 'SELECT') {
                        field.removeAttribute('disabled');
                    }
                }
            });
        }

        // Initial state: only show Edit button, form fields are read-only
        saveButton.style.display = 'none';
        resetButton.style.display = 'none';
        setFormReadonly(true);

        // When Edit button is clicked
        editButton.addEventListener('click', function() {
            editButton.style.display = 'none';
            saveButton.style.display = 'inline-block';
            resetButton.style.display = 'inline-block';
            setFormReadonly(false);
        });

        // When Save Changes or Reset button is clicked
        function handleSaveOrResetClick() {
            saveButton.style.display = 'none';
            resetButton.style.display = 'none';
            editButton.style.display = 'inline-block';
             // Form fields will become read-only again *after* the form submission or reset.
            // For the 'Reset' button, we reset the form before changing button visibility.
        }

         // Add event listener for Save button (it's a submit button)
        // The form submission itself will handle the save action.
        // We attach the click listener to change buttons BEFORE potential submission.
        saveButton.addEventListener('click', function() {
             // This will run before the form is submitted
             // The read-only state will be reset after the page reloads from submission
        });

        resetButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default button click behavior first
            mainForm.reset(); // Reset the form
            handleSaveOrResetClick(); // Change button visibility and set form read-only
            setFormReadonly(true); // Ensure fields are read-only after reset
        });

        // Re-apply read-only after potential form submission (page load)
         window.addEventListener('load', function() {
             setFormReadonly(true);
         });
          // Handle the case where the Save button was clicked and the page reloaded without a full navigation
         if (window.performance && window.performance.getEntriesByType('navigation')[0].type === 'reload') {
             setFormReadonly(true);
         }
    });
</script>
{% endblock %}

{% endblock %}