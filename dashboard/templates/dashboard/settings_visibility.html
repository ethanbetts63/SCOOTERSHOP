{% extends "dashboard/admin_layout.html" %}
{% load static %}

{% block extra_css %}
<style>
    .form-check input {
        border: 1px solid #ccc;
        color: #000;
    }
    .form-check-label {
        color: #000;
        margin-left: 0.5rem;
    }
    .form-check {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
    .form-text {
        margin-left: 1.5rem; /* Indent help text */
    }
</style>
{% endblock %}

{% block admin_main_content %}
<div class="container mx-auto px-4 py-8">
    <div class="bg-white shadow-lg rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
            Visibility Settings
        </h1>

        <p class="text-gray-600 mb-6">Control which features are visible and enabled on your website. Disabled pages will appear blue in the navigation bar from the perspective of an admin account and will not appear at all from the perspective of a user account.</p>

        <form method="post" class="space-y-6">
            {% csrf_token %}

            <div class="flex justify-end mb-4">
                <button type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l" id="editButton">Edit</button>
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4" id="saveButton">Save Changes</button>
                <button type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r" id="resetButton">Reset</button>
            </div>

            <div class="space-y-4">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Module Visibility</h3>
                
                <div class="form-check">
                    {{ form.enable_sales_new }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_sales_new.id_for_label }}">Enable New Sales</label>
                        <small class="block text-gray-500 form-text">Allow users to view and enquire about new motorcycles.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_sales_used }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_sales_used.id_for_label }}">Enable Used Sales</label>
                        <small class="block text-gray-500 form-text">Allow users to view and enquire about used motorcycles.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_service_booking }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_service_booking.id_for_label }}">Enable Service Booking</label>
                        <small class="block text-gray-500 form-text">Allow users to book motorcycle services online.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_faq_service }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_faq_service.id_for_label }}">Enable Service faqs</label>
                        <small class="block text-gray-500 form-text">Show the Frequently Asked Questions section on the service page.</small>
                    </div>
                </div>
                 <div class="form-check">
                    {{ form.enable_faq_sales }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_faq_sales.id_for_label }}">Enable Sales faqs</label>
                        <small class="block text-gray-500 form-text">Show the Frequently Asked Questions section on sales pages.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_user_accounts }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_user_accounts.id_for_label }}">Enable User Accounts</label>
                        <small class="block text-gray-500 form-text">Allow users to register and maintain accounts.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_contact_page }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_contact_page.id_for_label }}">Enable Contact Page</label>
                        <small class="block text-gray-500 form-text">Allow users to access the contact us page.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_privacy_policy_page }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_privacy_policy_page.id_for_label }}">Enable Privacy Policy Page</label>
                        <small class="block text-gray-500 form-text">Allow users to access the privacy policy page.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_returns_page }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_returns_page.id_for_label }}">Enable Returns Page</label>
                        <small class="block text-gray-500 form-text">Allow users to access the returns page.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_security_page }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_security_page.id_for_label }}">Enable Security Page</label>
                        <small class="block text-gray-500 form-text">Allow users to access the security page.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_refunds }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_refunds.id_for_label }}">Enable Refunds Page</label>
                        <small class="block text-gray-500 form-text">Allow users to access the refunds request page.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_motorcycle_mover }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_motorcycle_mover.id_for_label }}">Enable Motorcycle Mover</label>
                        <small class="block text-gray-500 form-text">Enable the motorcycle mover section.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_frank }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_frank.id_for_label }}">Enable "Why Choose Us" Section</label>
                        <small class="block text-gray-500 form-text">Enable the 'Why Choose Us' section on the homepage.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.enable_banner }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_banner.id_for_label }}">Enable Banner</label>
                        <small class="block text-gray-500 form-text">Enable a site-wide announcement banner.</small>
                    </div>
                </div>
            </div>

            <div class="space-y-4 pt-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Content Display</h3>
                <div class="form-check">
                    {{ form.display_phone_number }}
                    <div>
                        <label class="form-check-label" for="{{ form.display_phone_number.id_for_label }}">Display Phone Number</label>
                        <small class="block text-gray-500 form-text">Show the business phone number in the site header and footer.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.display_address }}
                    <div>
                        <label class="form-check-label" for="{{ form.display_address.id_for_label }}">Display Address</label>
                        <small class="block text-gray-500 form-text">Show the business address in the site footer and on the contact page.</small>
                    </div>
                </div>
                <div class="form-check">
                    {{ form.display_opening_hours }}
                    <div>
                        <label class="form-check-label" for="{{ form.display_opening_hours.id_for_label }}">Display Opening Hours</label>
                        <small class="block text-gray-500 form-text">Show the business opening hours in the site footer.</small>
                    </div>
                </div>
                 <div class="form-check">
                    {{ form.enable_map_display }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_map_display.id_for_label }}">Enable Map Display</label>
                        <small class="block text-gray-500 form-text">Show location map on relevant pages.</small>
                    </div>
                </div>
                 <div class="form-check">
                    {{ form.enable_google_places_reviews }}
                    <div>
                        <label class="form-check-label" for="{{ form.enable_google_places_reviews.id_for_label }}">Enable Google Reviews</label>
                        <small class="block text-gray-500 form-text">Show Google Places reviews on the site.</small>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editButton = document.getElementById('editButton');
        const saveButton = document.getElementById('saveButton');
        const resetButton = document.getElementById('resetButton');
        // Select form fields within this specific form
        const mainForm = document.querySelector('form[method="post"]');
        const formFields = mainForm.querySelectorAll('input, select, textarea');

        // Function to set form fields read-only or enabled
        function setFormReadonly(readonly) {
            formFields.forEach(field => {
                if (readonly) {
                    field.setAttribute('readonly', true);
                    // Prevent checkbox interaction when read-only
                    if (field.type === 'checkbox' || field.tagName === 'SELECT') {
                         field.setAttribute('disabled', true);
                    }
                } else {
                    field.removeAttribute('readonly');
                     if (field.type === 'checkbox' || field.tagName === 'SELECT') {
                        field.removeAttribute('disabled');
                    }
                }
            });
        }

        // Initial state: only show Edit button, form fields are read-only
        saveButton.style.display = 'none';
        resetButton.style.display = 'none';
        setFormReadonly(true);

        // When Edit button is clicked
        editButton.addEventListener('click', function() {
            editButton.style.display = 'none';
            saveButton.style.display = 'inline-block';
            resetButton.style.display = 'inline-block';
            setFormReadonly(false);
        });

        // When Save Changes or Reset button is clicked
        function handleSaveOrResetClick() {
            saveButton.style.display = 'none';
            resetButton.style.display = 'none';
            editButton.style.display = 'inline-block';
             // Form fields will become read-only again *after* the form submission or reset.
            // For the 'Reset' button, we reset the form before changing button visibility.
        }

         // Add event listener for Save button (it's a submit button)
        // The form submission itself will handle the save action.
        // We attach the click listener to change buttons BEFORE potential submission.
        saveButton.addEventListener('click', function() {
             // This will run before the form is submitted
             // The read-only state will be reset after the page reloads from submission
        });

        resetButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default button click behavior first
            mainForm.reset(); // Reset the form
            handleSaveOrResetClick(); // Change button visibility and set form read-only
            setFormReadonly(true); // Ensure fields are read-only after reset
        });

        // Re-apply read-only after potential form submission (page load)
         window.addEventListener('load', function() {
             setFormReadonly(true);
         });
          // Handle the case where the Save button was clicked and the page reloaded without a full navigation
         if (window.performance && window.performance.getEntriesByType('navigation')[0].type === 'reload') {
             setFormReadonly(true);
         }
    });
</script>
{% endblock %}

{% endblock %}
