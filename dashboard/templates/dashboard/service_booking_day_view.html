{% extends "dashboard/admin_layout.html" %}
{% load static %}

{% block admin_main_content %}
<link rel="stylesheet" href="{% static 'css/service_booking_styles.css' %}">
{# You might reuse some calendar styles or add new ones for the day view #}
<link rel="stylesheet" href="{% static 'css/calendar_styles.css' %}">

<h2>Service Bookings for {{ selected_date|date:"l, F j, Y" }}</h2>

{# Link back to the month view #}
<p><a href="{% url 'dashboard:service_bookings' %}?year={{ selected_date.year }}&month={{ selected_date.month }}">Back to Month View</a></p>

<div class="card shadow mb-4">
    <div class="card-header">
        <h6 class="m-0 font-weight-bold text-primary">Bookings on this Day</h6>
    </div>
    <div class="card-body">
        {% if bookings_for_day %}
            <div class="booking-list">
                {% for booking in bookings_for_day %}
                    {# Reuse the booking tile structure or create a new one #}
                    <div class="booking-tile card mb-2" data-detail-url="{% url 'dashboard:service_booking_details' pk=booking.pk %}">
                         <div class="card-body py-2 px-3">
                            <div class="booking-details">
                                <div class="booking-info-line">
                                    <span class="booking-time">{{ booking.appointment_datetime|date:"H:i" }}</span>
                                    <span class="separator">|</span>
                                    <span class="customer-name">{{ booking.customer.get_full_name or booking.customer_name }}</span>
                                    <span class="separator">|</span>
                                    <span class="service-type">{{ booking.service_type.name }}</span>
                                    <span class="separator">|</span>
                                    <span class="booking-status status-{{ booking.status }}">{{ booking.get_status_display }}</span>
                                </div>
                                {# Add more details if needed, e.g., vehicle #}
                                <div class="booking-info-extra">
                                    {% if booking.vehicle %}
                                        <span class="vehicle-info">{{ booking.vehicle.year }} {{ booking.vehicle.make }} {{ booking.vehicle.model }} (Rego: {{ booking.vehicle.rego|default_if_none:"N/A" }})</span>
                                    {% elif booking.anon_vehicle_make %}
                                         <span class="vehicle-info">{{ booking.anon_vehicle_year|default_if_none:"" }} {{ booking.anon_vehicle_make }} {{ booking.anon_vehicle_model }} (Rego: {{ booking.anon_vehicle_rego|default_if_none:"N/A" }})</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No service bookings scheduled for this day.</p>
        {% endif %}
    </div>
</div>

{# JavaScript for clicking booking tiles can be reused #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const bookingTiles = document.querySelectorAll('.booking-tile');
            bookingTiles.forEach(tile => {
                tile.addEventListener('click', function() {
                    const detailUrl = this.getAttribute('data-detail-url');
                    if (detailUrl) {
                        window.location.href = detailUrl;
                    }
                });
            });
        });
    </script>

{% endblock %}