{% extends "dashboard/admin_layout.html" %}
{% load static %}

{% block admin_main_content %}
{# Your existing CSS links #}
<link rel="stylesheet" href="{% static 'css/service_booking_styles.css' %}">
<link rel="stylesheet" href="{% static 'css/calendar_styles.css' %}">

{# Include FullCalendar's core CSS #}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css' rel='stylesheet' />

<h2>Service Bookings Calendar</h2>

{# Container for the search and filtering section (keep or remove as needed) #}
<div class="card shadow mb-4">
    <div class="card-header">
        <h6 class="m-0 font-weight-bold text-primary">Search & Filters</h6>
    </div>
    <div class="card-body">
        {# Search form and filter options will go here #}
        <p>Search and filter options coming soon...</p>
    </div>
</div>

<div class="card shadow mb-4">
    <div class="card-header">
        <h6 class="m-0 font-weight-bold text-primary">Booking Calendar</h6>
    </div>
    <div class="card-body">
        {# This is the div where FullCalendar will render the calendar.
           You can replace the existing content of this div. #}
        <div id='fullcalendar'>
            {# FullCalendar will build the calendar inside this div #}
        </div>
    </div>
</div>

{# The existing recent bookings list can remain below the calendar #}
{# ... your existing recent bookings list div ... #}
<div class="card shadow mb-4">
    <div class="card-header d-flex flex-column align-items-center">
        <h6 class="m-0 font-weight-bold text-primary card-header-title">Recent Bookings (List View)</h6>
    </div>
    <div class="card-body">
        {% if bookings %}
            <div class="booking-list">
                {% for booking in bookings|slice:":5" %}
                    <div class="booking-tile card mb-2" data-detail-url="{% url 'dashboard:service_booking_details' pk=booking.pk %}">
                         <div class="card-body py-2 px-3">
                            <div class="booking-details">
                                <div class="booking-info-line">
                                    <span class="customer-name">{{ booking.customer_name }}</span>
                                    <span class="separator">|</span>
                                    <span class="booking-datetime"><i class="far fa-calendar-alt mr-1"></i> {{ booking.appointment_datetime|date:"Y-m-d H:i" }}</span>
                                    <span class="separator">|</span>
                                    <span class="service-type"><i class="fas fa-tools mr-1"></i> {{ booking.service_type.name }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No recent service bookings found.</p>
        {% endif %}
    </div>
    <div class="text-center mt-3">
        {# This link might change or be removed once the calendar view is primary #}
        {# You might remove or adjust this link later #}
        <a href="{% url 'dashboard:service_bookings' %}" class="btn btn-primary btn-sm">
             View All Bookings <i class="fas fa-arrow-right"></i>
        </a>
    </div>
</div>


{# Include FullCalendar's core JavaScript file #}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

{# Include the interaction plugin if you plan to use features like clicking dates/events #}
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.11/index.global.min.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('fullcalendar'); // Get the HTML element

        var calendar = new FullCalendar.Calendar(calendarEl, {
            // ** REQUIRED OPTIONS **
            initialView: 'dayGridMonth', // Specifies the default view (e.g., month view)

            // ** OPTIONAL CONFIGURATION **
            headerToolbar: { // Customize the buttons and title at the top
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay' // Example: add buttons for different views
            },

            // --- Interactivity (Using the interaction plugin) ---
            dateClick: function(info) {
                // This function is called when a date is clicked
                alert('Clicked on: ' + info.dateStr); // Example: show the date
                // You could redirect to your day view here, e.g.:
                // window.location.href = `/dashboard/bookings/${info.date.getFullYear()}/${info.date.getMonth() + 1}/${info.date.getDate()}/`;
            },
        });

        // Render the calendar on the page
        calendar.render();
    });

</script>

{% endblock %}