{% extends 'core/layout.html' %}
{% load static %}

{% block extra_css %}
{{ block.super }}
    <link rel="stylesheet" href="{% static 'css/booking_styles.css' %}">
    <style>
        /* Style for the required asterisk */
        .required-asterisk {
            color: red;
            margin-left: 4px;
        }
    </style>
{% endblock %}

{% block title %}Step 4: Driver Details (account){% endblock %}

{% block content %}
<div class="service-booking-container">
    <div class="booking-progress">
        <h2>Driver Details</h2>
    </div>
    <p>Please review and update your driver information.</p>

    <form method="post" enctype="multipart/form-data" id="driver-details-form">
        {% csrf_token %}

        <div class="form-group">
            {{ form.name.label_tag }}<span class="required-asterisk">*</span>
            {{ form.name }}
            {% if form.name.errors %}
                <div class="error">{{ form.name.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.email.label_tag }}<span class="required-asterisk">*</span>
            {{ form.email }}
            {% if form.email.errors %}
                <div class="error">{{ form.email.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.phone_number.label_tag }}<span class="required-asterisk">*</span>
            {{ form.phone_number }}
            {% if form.phone_number.errors %}
                <div class="error">{{ form.phone_number.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.address_line_1.label_tag }}<span class="required-asterisk">*</span>
            {{ form.address_line_1 }}
            {% if form.address_line_1.errors %}
                <div class="error">{{ form.address_line_1.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.address_line_2.label_tag }}
            {{ form.address_line_2 }}
            {% if form.address_line_2.errors %}
                <div class="error">{{ form.address_line_2.errors }}</div>
            {% endif %}
        </div>

        <div class="row">
            <div class="col-md-6 form-group">
                {{ form.city.label_tag }}<span class="required-asterisk">*</span>
                {{ form.city }}
                {% if form.city.errors %}
                    <div class="error">{{ form.city.errors }}</div>
                {% endif %}
            </div>
            <div class="col-md-6 form-group">
                {{ form.state.label_tag }}
                {{ form.state }}
                {% if form.state.errors %}
                    <div class="error">{{ form.state.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div class="form-group">
            {{ form.post_code.label_tag }}
            {{ form.post_code }}
            {% if form.post_code.errors %}
                <div class="error">{{ form.post_code.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.country.label_tag }}<span class="required-asterisk">*</span>
            {{ form.country }}
            {% if form.country.errors %}
                <div class="error">{{ form.country.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.date_of_birth.label_tag }}<span class="required-asterisk">*</span>
            {{ form.date_of_birth }}
            {% if form.date_of_birth.errors %}
                <div class="error">{{ form.date_of_birth.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.is_australian_resident.label_tag }}<span class="required-asterisk">*</span>
            {{ form.is_australian_resident }}
            {% if form.is_australian_resident.errors %}
                <div class="error">{{ form.is_australian_resident.errors }}</div>
            {% endif %}
        </div>

        <div id="australian-fields">
            <div class="form-group">
                {{ form.license_number.label_tag }}<span class="required-asterisk">*</span>
                {{ form.license_number }}
                {% if form.license_number.errors %}
                    <div class="error">{{ form.license_number.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.license_expiry_date.label_tag }}<span class="required-asterisk">*</span>
                {{ form.license_expiry_date }}
                {% if form.license_expiry_date.errors %}
                    <div class="error">{{ form.license_expiry_date.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.license_photo.label_tag }}<span class="required-asterisk">*</span>
                {{ form.license_photo }}
                {% if form.license_photo.errors %}
                    <div class="error">{{ form.license_photo.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div id="international-fields">
            <div class="form-group">
                {{ form.international_license_expiry_date.label_tag }}<span class="required-asterisk">*</span>
                {{ form.international_license_expiry_date }}
                {% if form.international_license_expiry_date.errors %}
                    <div class="error">{{ form.international_license_expiry_date.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.international_license_issuing_country.label_tag }}<span class="required-asterisk">*</span>
                {{ form.international_license_issuing_country }}
                {% if form.international_license_issuing_country.errors %}
                    <div class="error">{{ form.international_license_issuing_country.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.international_license_photo.label_tag }}<span class="required-asterisk">*</span>
                {{ form.international_license_photo }}
                {% if form.international_license_photo.errors %}
                    <div class="error">{{ form.international_license_photo.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.passport_number.label_tag }}<span class="required-asterisk">*</span>
                {{ form.passport_number }}
                {% if form.passport_number.errors %}
                    <div class="error">{{ form.passport_number.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.passport_expiry_date.label_tag }}<span class="required-asterisk">*</span>
                {{ form.passport_expiry_date }}
                {% if form.passport_expiry_date.errors %}
                    <div class="error">{{ form.passport_expiry_date.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.passport_photo.label_tag }}<span class="required-asterisk">*</span>
                {{ form.passport_photo }}
                {% if form.passport_photo.errors %}
                    <div class="error">{{ form.passport_photo.errors }}</div>
                {% endif %}
            </div>
        </div>

        <button type="submit">Continue to Next Step</button>
    </form>

    <p><a href="{% url 'hire:step3_addons_and_packages' temp_booking.motorcycle.id %}" class="btn-secondary">Back to Previous Step</a></p>
</div>

{% block extra_js %}
{{ block.super }}
<script>
    const isAustralianResidentSelect = document.getElementById('id_is_australian_resident');
    const australianFields = document.getElementById('australian-fields');
    const internationalFields = document.getElementById('international-fields');

    function toggleFields() {
        if (isAustralianResidentSelect.value === 'True') {
            australianFields.style.display = 'block';
            internationalFields.style.display = 'none';
        } else if (isAustralianResidentSelect.value === 'False') {
            australianFields.style.display = 'none';
            internationalFields.style.display = 'block';
        } else {
            australianFields.style.display = 'none';
            internationalFields.style.display = 'none';
        }
    }

    // Initial setup on page load
    toggleFields();

    // Event listener for changes to the select field
    isAustralianResidentSelect.addEventListener('change', toggleFields);
</script>
{% endblock %}

{% endblock %}
