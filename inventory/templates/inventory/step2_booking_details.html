{% extends 'core/layout.html' %}
{% load static %}

{% block title %}Book Your Sales Appointment - {{ block.super }}{% endblock %}

{% block content %}
<div>
    <div>
        <h2>Book Your Sales Appointment</h2>

        {% if temp_booking.motorcycle %}
        <div>
            <h3>Motorcycle Details:</h3>
            <p><strong>{{ temp_booking.motorcycle.year }} {{ temp_booking.motorcycle.brand }} {{ temp_booking.motorcycle.model }}</strong></p>
            <p>Price: {{ inventory_settings.currency_symbol }}{{ temp_booking.motorcycle.price|floatformat:2 }}</p>
        </div>
        {% endif %}

        <form method="post" action="{% url 'inventory:step2_booking_details_and_appointment' %}">
            {% csrf_token %}

            {% if not temp_booking.deposit_required_for_flow %}
                <div>
                    <label>{{ form.request_viewing.label }}</label>
                    <div>
                        {% for radio in form.request_viewing %}
                            <label>
                                {{ radio.tag }}
                                <span>{{ radio.choice_label }}</span>
                            </label>
                        {% endfor %}
                    </div>
                    <p>{{ form.request_viewing.help_text }}</p>
                    {% if form.request_viewing.errors %}
                        <div>
                            {% for error in form.request_viewing.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
            {{ form.request_viewing.as_hidden }}


            <div id="appointment-date-field">
                <label for="{{ form.appointment_date.id_for_label }}">
                    {{ form.appointment_date.label }}
                </label>
                <input type="text"
                       id="{{ form.appointment_date.id_for_label }}"
                       name="{{ form.appointment_date.html_name }}"
                       placeholder="Select preferred date"
                       value="{{ form.appointment_date.value|default:''|date:'Y-m-d' }}"
                >
                <p>{{ form.appointment_date.help_text }}</p>
                {% if form.appointment_date.errors %}
                    <div>
                        {% for error in form.appointment_date.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div id="appointment-time-field">
                <label for="{{ form.appointment_time.id_for_label }}">
                    {{ form.appointment_time.label }}
                </label>
                <select id="{{ form.appointment_time.id_for_label }}"
                        name="{{ form.appointment_time.html_name }}"
                        {% if not form.appointment_date.value %}disabled{% endif %}
                >
                    <option value="">Select a time</option>
                    {% if form.appointment_time.value %}
                        <option value="{{ form.appointment_time.value|time:'H:i' }}" selected>{{ form.appointment_time.value|time:'h:i A' }}</option>
                    {% endif %}
                </select>
                <p>{{ form.appointment_time.help_text }}</p>
                {% if form.appointment_time.errors %}
                    <div>
                        {% for error in form.appointment_time.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                <div id="loading-times">Loading available times...</div>
            </div>

            <div>
                <label for="{{ form.customer_notes.id_for_label }}">
                    {{ form.customer_notes.label }}
                </label>
                <textarea id="{{ form.customer_notes.id_for_label }}"
                          name="{{ form.customer_notes.html_name }}"
                          rows="4"
                          placeholder="{{ form.customer_notes.field.widget.attrs.placeholder }}"
                >{{ form.customer_notes.value|default:'' }}</textarea>
                <p>{{ form.customer_notes.help_text }}</p>
                {% if form.customer_notes.errors %}
                    <div>
                        {% for error in form.customer_notes.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div>
                <div>
                    <div>
                        <input id="{{ form.terms_accepted.id_for_label }}"
                               name="{{ form.terms_accepted.html_name }}"
                               type="checkbox"
                               {% if form.terms_accepted.value %}checked{% endif %}
                        >
                    </div>
                    <div>
                        <label for="{{ form.terms_accepted.id_for_label }}">
                            {{ form.terms_accepted.label }}
                        </label>
                        <p>{{ form.terms_accepted.help_text }}</p>
                    </div>
                </div>
                {% if form.terms_accepted.errors %}
                    <div>
                        {% for error in form.terms_accepted.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                {% if inventory_settings.terms_and_conditions_text %}
                    <div>
                        <h4>Our Terms and Conditions:</h4>
                        <p>{{ inventory_settings.terms_and_conditions_text|linebreaksbr }}</p>
                    </div>
                {% endif %}
            </div>

            <div>
                <button type="submit">
                    {% if temp_booking.deposit_required_for_flow %}
                        Proceed to Payment
                    {% else %}
                        Submit Enquiry
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock content %}
