{% extends 'core/layout.html' %}
{% load static %}

{% block title %}Sales Booking Confirmation - {{ block.super }}{% endblock %}

{% block content %}
<div>
    <div>
        <h2>Your Sales Booking Confirmation</h2>

        {% if is_processing %}
            <div id="processing-message">
                <p>Your booking is currently being finalized. This may take a moment. Please do not close this window.</p>
                <p>We are confirming your payment and reserving the motorcycle for you.</p>
                <p>Status: Processing...</p>
            </div>
            <div>
                <div></div>
                <p>Please wait while we confirm your booking.</p>
            </div>

        {% else %}
            {% if sales_booking %}
                <div>
                    {% if sales_booking.payment_status == 'deposit_paid' %}
                        <p>Your deposit has been confirmed!</p>
                        <p>The motorcycle ({{ sales_booking.motorcycle.year }} {{ sales_booking.motorcycle.brand }} {{ sales_booking.motorcycle.model }}) has been delisted from our website and is now reserved for you.</p>
                        {% if sales_booking.appointment_date %}
                        <p>Your requested appointment date is <strong>{{ sales_booking.appointment_date|date:"D, M d, Y" }} at {{ sales_booking.appointment_time|time:"P" }}</strong>. Please note that this appointment is not yet confirmed.</p>
                        <p>You will receive a separate confirmation email after our admin team has reviewed your booking details and confirmed the appointment.</p>
                        {% else %}
                        <p>Our team will be in touch shortly to finalize the details and arrange your viewing/pickup.</p>
                        {% endif %}
                    {% else %}
                        <p>Thank you for your enquiry!</p>
                        <p>We have received your request regarding the motorcycle ({{ sales_booking.motorcycle.year }} {{ sales_booking.motorcycle.brand }} {{ sales_booking.motorcycle.model }}).</p>
                        {% if sales_booking.appointment_date %}
                        <p>You requested an appointment on <strong>{{ sales_booking.appointment_date|date:"D, M d, Y" }} at {{ sales_booking.appointment_time|time:"P" }}</strong>. Our admin team will contact you to confirm the appointment details.</p>
                        {% else %}
                        <p>Our admin team will get back to you as soon as possible to discuss your enquiry further.</p>
                        {% endif %}
                    {% endif %}
                    <p>A detailed confirmation email has been sent to your provided email address.</p>
                </div>

                <div>
                    <h3>Booking Summary</h3>
                    <table>
                        <tr>
                            <td>Booking Reference:</td>
                            <td><strong>{{ sales_booking.sales_booking_reference }}</strong></td>
                        </tr>
                        <tr>
                            <td>Customer Name:</td>
                            <td>{{ sales_booking.sales_profile.name }}</td>
                        </tr>
                        <tr>
                            <td>Motorcycle:</td>
                            <td>{{ sales_booking.motorcycle.year }} {{ sales_booking.motorcycle.brand }} {{ sales_booking.motorcycle.model }}</td>
                        </tr>
                        <tr>
                            <td>Motorcycle Price:</td>
                            <td>{{ sales_booking.motorcycle_price|floatformat:2 }} {{ sales_booking.currency }}</td>
                        </tr>
                        <tr>
                            <td>Payment Status:</td>
                            <td>{{ sales_booking.payment_status }}</td>
                        </tr>
                        <tr>
                            <td>Amount Paid:</td>
                            <td>{{ sales_booking.amount_paid|floatformat:2 }} {{ sales_booking.currency }}</td>
                        </tr>
                        <tr>
                            <td>Amount Owing:</td>
                            <td>{{ amount_owing|floatformat:2 }} {{ sales_booking.currency }}</td>
                        </tr>
                        {% if sales_booking.appointment_date %}
                        <tr>
                            <td>Requested Appointment Date:</td>
                            <td>{{ sales_booking.appointment_date|date:"F d, Y" }}</td>
                        </tr>
                        <tr>
                            <td>Requested Appointment Time:</td>
                            <td>{{ sales_booking.appointment_time|time:"P" }}</td>
                        </tr>
                        {% endif %}
                        {% if sales_booking.customer_notes %}
                        <tr>
                            <td>Your Notes:</td>
                            <td>{{ sales_booking.customer_notes }}</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>

                <div>
                    <a href="{% url 'inventory:all' %}">
                        Browse More Motorcycles
                    </a>
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock content %}
