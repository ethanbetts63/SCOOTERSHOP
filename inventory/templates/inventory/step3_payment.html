{% extends 'core/layout.html' %}
{% load static %}

{% block title %}Complete Sales Booking Deposit - {{ block.super }}{% endblock %}

{% block content %}
<div>
    <div>
        <h2>Complete Your Deposit</h2>

        {% if payment_already_succeeded %}
        <div id="payment-success-message">
            <span>Your payment has already been successfully processed. Redirecting you to confirmation...</span>
        </div>
        {% endif %}

        <div>
            <h3>Deposit Summary</h3>
            {% if temp_booking.motorcycle %}
            <p>
                Motorcycle: <span>{{ temp_booking.motorcycle.year }} {{ temp_booking.motorcycle.brand }} {{ temp_booking.motorcycle.model }}</span>
            </p>
            <p>
                Motorcycle Price: <span>{{ temp_booking.motorcycle.price|floatformat:2 }} {{ currency }}</span>
            </p>
            {% endif %}

            {% if temp_booking.appointment_date %}
            <p>
                Requested Appointment: <span>{{ temp_booking.appointment_date|date:"F d, Y" }} at {{ temp_booking.appointment_time|time:"P" }}</span>
            </p>
            {% endif %}

            <p>
                Deposit Amount: <span>{{ amount|floatformat:2 }} {{ currency }}</span>
            </p>
             <p>
                Amount Remaining (approx.): <span>{{ amount_remaining|floatformat:2 }} {{ currency }}</span>
            </p>
            <p>
                Your deposit secures the motorcycle and it will be marked as reserved.
                The remaining balance will be handled separately.
            </p>
        </div>

        <form id="payment-form">
            {% csrf_token %}
            <div>
                <label for="card-element">
                    Credit or debit card
                </label>
                <div id="card-element">
                    <!-- A Stripe Element will be inserted here. -->
                </div>
                <div id="card-errors" role="alert"></div>
            </div>

            <div id="payment-message">
                <span></span>
            </div>

            <button id="submit-button">
                Pay {{ amount|floatformat:2 }} {{ currency }} Deposit
            </button>
        </form>
    </div>
</div>
{% endblock content %}
