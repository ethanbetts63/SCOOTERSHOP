{% extends 'core/layout.html' %}
{% load static %}

{% block title %}Book Service - Step 3{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">

    <div class="mb-6">
        <h2 class="text-3xl font-bold text-white">Book Service - Step {{ step|default:'3' }} of {{ total_steps|default:'7' }}</h2>
    </div>

    {% include 'service/_booking_summary_include.html' %}

    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6 mt-4">
        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Your Motorcycle Details</h3>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="space-y-6">
                <div>
                    <h4 class="text-lg font-medium text-gray-700 mb-2">Required Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.brand.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.brand.label }}{% if form.brand.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.brand }}
                            {% if form.brand.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.brand.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div id="otherBrandNameDiv" style="display: none;">
                            <label for="{{ form.other_brand_name.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.other_brand_name.label }}<span id="other-brand-asterisk" class="text-red-500"></span></label>
                            {{ form.other_brand_name }}
                            {% if form.other_brand_name.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.other_brand_name.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div>
                            <label for="{{ form.model.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.model.label }}{% if form.model.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.model }}
                            {% if form.model.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.model.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>
                        
                        <div>
                            <label for="{{ form.engine_size.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.engine_size.label }}{% if form.engine_size.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.engine_size }}
                            {% if form.engine_size.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.engine_size.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div>
                            <label for="{{ form.year.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.year.label }}{% if form.year.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.year }}
                            {% if form.year.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.year.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div>
                            <label for="{{ form.rego.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.rego.label }}{% if form.rego.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.rego }}
                            {% if form.rego.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.rego.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div>
                            <label for="{{ form.odometer.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.odometer.label }}{% if form.odometer.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.odometer }}
                            {% if form.odometer.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.odometer.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>
                        
                        <div>
                            <label for="{{ form.transmission.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.transmission.label }}{% if form.transmission.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.transmission }}
                            {% if form.transmission.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.transmission.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>
                    </div>
                </div>

                <div class="pt-6 border-t border-gray-200">
                    <h4 class="text-lg font-medium text-gray-700 mb-2">Optional Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.vin_number.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.vin_number.label }}{% if form.vin_number.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.vin_number }}
                            {% if form.vin_number.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.vin_number.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div>
                            <label for="{{ form.engine_number.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.engine_number.label }}{% if form.engine_number.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.engine_number }}
                            {% if form.engine_number.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.engine_number.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                        </div>

                        <div class="md:col-span-2">
                            <label for="{{ form.image.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ form.image.label }}{% if form.image.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            {{ form.image }}
                            {% if form.image.help_text %}<p class="mt-2 text-sm text-gray-500">{{ form.image.help_text }}</p>{% endif %}
                            {% if form.image.errors %}<div class="mt-1 text-sm text-red-600">{% for error in form.image.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
                            {% if form.instance.image %}
                                <div class="mt-4">
                                    <p class="block text-sm font-medium text-gray-700">Current Image:</p>
                                    <img src="{{ form.instance.image.url }}" alt="Current Motorcycle Image" class="mt-2 rounded-lg border border-gray-200" style="max-width: 150px; height: auto;">
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-between pt-8 mt-8 border-t border-gray-200">
                <a href="{% url 'service:service_book_step2' %}" class="text-sm font-medium text-gray-600 hover:text-indigo-500 transition duration-150 ease-in-out">
                    &larr; Previous Step
                </a>
                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Next Step &rarr;
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const formInputs = document.querySelectorAll('input[type="text"], input[type="number"], input[type="email"], select');
        const fileInputs = document.querySelectorAll('input[type="file"]');

        const standardClasses = ['mt-1', 'block', 'w-full', 'py-2', 'px-3', 'border', 'border-gray-400', 'rounded-md', 'shadow-sm', 'text-gray-900', 'focus:outline-none', 'focus:ring-indigo-500', 'focus:border-indigo-500', 'sm:text-sm'];
        const fileInputClasses = ['mt-1', 'block', 'w-full', 'text-sm', 'text-gray-500', 'file:mr-4', 'file:py-2', 'file:px-4', 'file:rounded-md', 'file:border-0', 'file:text-sm', 'file:font-semibold', 'file:bg-indigo-50', 'file:text-indigo-700', 'hover:file:bg-indigo-100'];

        formInputs.forEach(input => input.classList.add(...standardClasses));
        fileInputs.forEach(input => input.classList.add(...fileInputClasses));

        const brandSelect = document.getElementById('{{ form.brand.id_for_label }}');
        const otherBrandNameDiv = document.getElementById('otherBrandNameDiv');
        const otherBrandNameInput = document.getElementById('{{ form.other_brand_name.id_for_label }}');
        const otherBrandAsterisk = document.getElementById('other-brand-asterisk');
        
        function toggleOtherBrandField() {
            if (brandSelect.value === 'Other') {
                otherBrandNameDiv.style.display = 'block';
                otherBrandNameInput.setAttribute('required', 'required');
                if(otherBrandAsterisk) otherBrandAsterisk.textContent = ' *';
            } else {
                otherBrandNameDiv.style.display = 'none';
                otherBrandNameInput.removeAttribute('required');
                if(otherBrandAsterisk) otherBrandAsterisk.textContent = '';
                otherBrandNameInput.value = '';
            }
        }
        
        if (brandSelect) {
            toggleOtherBrandField();
            brandSelect.addEventListener('change', toggleOtherBrandField);
        }
    });
</script>
{% endblock %}
