<div id="map-container" style="width: 100%; height: 400px;">
    <iframe
        width="100%"
        height="100%"
        style="border:0"
        loading="lazy"
        allowfullscreen
        referrerpolicy="no-referrer-when-downgrade"
        data-src="https://www.google.com/maps/embed/v1/place">
    </iframe>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var mapContainer = document.getElementById('map-container');
        var mapIframe = mapContainer.querySelector('iframe');
        var apiKey = '{{ maps_api_key }}'; 
        var placeId = '{{ place_id }}'; 

        var observer = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    // Element is visible in the viewport
                    var src = mapIframe.getAttribute('data-src') + '?key=' + apiKey + '&q=place_id:' + placeId;
                    mapIframe.setAttribute('src', src);

                    // Stop observing once the map is loaded
                    observer.unobserve(entry.target);
                }
            });
        }, {
            rootMargin: '0px', // No margin
            threshold: 0.1 // Trigger when 10% of the element is visible
        });

        // Start observing the map container
        observer.observe(mapContainer);
    });
</script>